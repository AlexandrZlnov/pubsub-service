2. Во второй части задания требуется с использованием пакета subpub из 1 части реализовать сервис подписок. Сервис работает по gRPC. Есть возможность подписаться на события по ключу и опубликовать события по ключу для всех подписчиков.

Protobuf-схема gRPC сервиса:

import "google/protobuf/empty.proto";

syntax = "proto3";

service PubSub {
    // Подписка (сервер отправляет поток событий)
    rpc Subscribe(SubscribeRequest) returns (stream Event);

    // Публикация (классический запрос-ответ)
    rpc Publish(PublishRequest) returns (google.protobuf.Empty);
}

message SubscribeRequest {
    string key = 1;
}

message PublishRequest {
    string key = 1;
    string data = 2;
}

message Event {
    string data = 1;
}

Также пользуйся стандартными статус-кодами gRPC из пакетов

google.golang.org/grpc/status

и

google.golang.org/grpc/codes в качестве критериев успешности и неуспешности запросов к сервису. Что еще ожидается в решении:

- Обязательно должно быть описание того, как работает сервис и как его собирать.
- У сервиса должен быть свой конфиг, куда можно прописать порты и прочие параметры (на ваше усмотрение).
- Логирование.
- Приветствуется использование известных паттернов при разработке микросервисов на Go (например, dependency injection, graceful shutdown и пр.). Если таковые будут использоваться, то просьба упомянуть его в описании решения.

Решение ожидается в качестве ссылки на репозиторий GitHub, ссылку вставь в поле ответа к этому заданию.

Чтобы проверяющие могли поверить решение нужно, чтобы ваш репозиторий был публичным!


----------------------------------------------
Задание:

Требуется с использованием пакета subpub реализовать сервис подписок со следующими требованиями:
1. Сервис работает по gRPC. 
2. Есть возможность подписаться на события по ключу и опубликовать события по ключу для всех подписчиков.
3. Также пользуйся стандартными статус-кодами gRPC из пакетов - google.golang.org/grpc/status и google.golang.org/grpc/codes в качестве критериев успешности и неуспешности запросов к сервису
4. У сервиса должен быть свой конфиг, куда можно прописать порты и прочие параметры (на ваше усмотрение)
5. Должно быть Логирование.
6. Использовать известные паттерноы при разработке микросервисов на Go (например, dependency injection, graceful shutdown и пр.). Если таковые будут использоваться, то просьба упомянуть его в описании решения.
7. Обязательно учесть Protobuf-схема gRPC сервиса:
import "google/protobuf/empty.proto";
syntax = "proto3";
service PubSub {
    // Подписка (сервер отправляет поток событий)
    rpc Subscribe(SubscribeRequest) returns (stream Event);
    // Публикация (классический запрос-ответ)
    rpc Publish(PublishRequest) returns (google.protobuf.Empty);
}
message SubscribeRequest {
    string key = 1;
}
message PublishRequest {
    string key = 1;
    string data = 2;
}
message Event {
    string data = 1;
}

-----------------------------------------------
Результат v1:
Особенности реализации
1. Dependency Injection:
Все зависимости (логгер, конфиг, шина событий) внедряются через конструкторы
Это упрощает тестирование и делает код более модульным
2. Graceful Shutdown:
Сервер корректно обрабатывает сигналы завершения
Есть таймаут для graceful shutdown
Все ресурсы освобождаются (подписки, соединения)
3. Логирование:
Используется zerolog для структурированного логирования
Есть интерсепторы для логирования gRPC запросов
Логируются все важные события (подписки, публикации, ошибки)
4. Обработка ошибок:
Используются стандартные статус-коды gRPC
Все ошибки логируются
Клиент получает понятные сообщения об ошибках
5. Потокобезопасность:
Все разделяемые структуры защищены мьютексами
Используются каналы для коммуникации между горутинами
6. Масштабируемость:
Можно настроить максимальное количество подписок и размер очереди
Шина событий работает асинхронно и не блокирует вызовы

1. Запуск сервиса
Для запуска сервиса нужно:
- Сгенерировать gRPC код из .proto файла
- Собрать и запустить сервер

Пример команды для генерации кода:
protoc --go_out=. --go-grpc_out=. proto/pubsub.proto

Затем можно собрать и запустить сервер:
go build -o pubsub-server ./cmd/server
./pubsub-server

2. Тестирование
Для тестирования можно использовать gRPC клиент, например, grpcurl:

Подписаться на события:
grpcurl -plaintext -d '{"key": "test"}' localhost:50051 pubsub.PubSub/Subscribe

Опубликовать событие:
grpcurl -plaintext -d '{"key": "test", "data": "hello"}' localhost:50051 pubsub.PubSub/Publish